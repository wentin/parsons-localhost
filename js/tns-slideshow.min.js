var TNS=window.TNS||{};TNS.slideshow=function(element,options){if(options===undefined)options={};return new TNS.Slideshow(element,options)};TNS.Slideshow=function($){"use strict";var defaults={url:"/php/getDirectorAlbum.php",caption:true,hideCaption:true,limit:0,random:false,ratio:1.5,animation:"fade",template:"edu"};var captionEventsState=true;var doThat=function(){};var Slideshow=function(element,options){this.options=$.extend({},defaults,typeof options==="object"&&options);this.$element=$(element);this.init()};Slideshow.prototype={constructor:Slideshow,init:function(){if(!jQuery.flexslider){$('<script type="text/javascript"></script>').attr("src","/framework/js/jquery.flexslider-min.js").appendTo("head");$("head link[rel='stylesheet']").first().before("<link rel='stylesheet' href='/framework/css/flexslider-tns.css' type='text/css' media='screen'>")}if(typeof this.options.ratio==="string"&&this.options.ratio.indexOf(":")!==-1){var w=this.options.ratio.split(":")[0];var h=this.options.ratio.split(":")[1];this.options.ratio=w/h}if(this.options.hasOwnProperty("albumid")){this.options.albumId=this.options.albumid}if(this.options.hasOwnProperty("albumId")){this.getSSPlist()}else{var that=this;$(function(){that.processTags();that.initSlideshow();that.$element.find("li").first().addClass("active")})}},initSlideshow:function(){this.$element.addClass("slideshow flexslider").find("ul.tns-slides").addClass("slides");var that=this;var flexopts=$.extend({},this.options,{start:function(){$(that.$element).find(".spinner").remove();if(that.options.caption){if(that.options.hideCaption){if($(window).width()>767){that.captionEvents("on")}}else{that.$element.find(".slider-text").css("opacity",1)}}}});that.$element.find(".slides li img:first").load(function(e){that.setDirectionNavTop()});this.$element.flexslider(flexopts);this.$element.wrapInner('<div class="slides-wrapper" />');$(window).resize(function(){setMaxHeight();if($(window).width()>767){if(!that.captionEventsState){that.captionEvents("on")}}else if(that.captionEventsState){that.captionEvents("off")}that.setDirectionNavTop()});function setMaxHeight(){that.$element.find(".tns-slides li img").css("maxHeight",parseInt(that.$element.width()/that.options.ratio,10))}setMaxHeight()},setDirectionNavTop:function(){var img_h=this.$element.find(".slides li img:first").height();this.$element.find(".flex-direction-nav a").css("top",function(){return img_h/2-$(this).height()/2})},captionEvents:function(toggle){var that=this;if(toggle==="on"){that.$element.find(".slides-wrapper").on("mouseover",function(e){$(this).find(".slider-text").css("opacity",1)});that.$element.find(".slides-wrapper").on("mouseout",function(e){$(this).find(".slider-text").css("opacity",0)});that.captionEventsState=true}else{that.$element.find(".slides-wrapper").off();that.captionEventsState=false;this.$element.find(".slider-text").css("opacity",1)}},getSSPlist:function(){var that=this;$(function(){$(that.$element).html('<div class="spinner"><img src="http://newschool.edu/framework/imgs/spinner-80.gif" /></div>');$(that.$element).find(".spinner").css("height",that.options.height)});var url=that.options.url;delete that.options.url;this.options.width=this.options.width||this.$element.width();if(this.options.hasOwnProperty("minWidth")&&this.options.minWidth>this.options.width){this.options.width=this.options.minWidth}this.options.height=parseInt(this.options.width/this.options.ratio,10);$.getJSON(url,that.options,function(response){$(function(){$(that.$element).append(response.html);that.initSlideshow()})}).error(function(response){$(function(){$(that.$element).find(".spinner").text("error loading the slideshow")})})},processTags:function(){var els=this.$element.find("li");els.each(function(index){var $this=$(this);var data=$this.data();if(data.hasOwnProperty("type")){var el="";switch(data.type){case"vimeo":el=$("<iframe></iframe>").attr("src","http://player.vimeo.com/video/"+data.id+"?title=0&byline=0&portrait=0&color=ff9933&autoplay=0&fullscreen=0");el.height(350);break;case"youtube":el=$("<iframe></iframe>").attr("src","http://www.youtube.com/embed/"+data.id+"?modestbranding=1");el.height(350);break}if(el!==""){$this.html(el)}}})}};return Slideshow}(jQuery);$(function(){$(".tns-slideshow").each(function(i,el){TNS.slideshow(el,$(el).data())})});